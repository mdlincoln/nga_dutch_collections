require "parallel"
load "scrape/scraper.rb"

BASEURL = "http://www.nga.gov"
SYSCAT = "/content/ngaweb/research/online-editions/17th-century-dutch-paintings.html"

task :default => :retrieve

task :retrieve => "scrape/html" do
  # Get all object links
  links = object_url_list("#{BASEURL}#{SYSCAT}")
  puts links
  
  # Run load_file process for each file in parallel
  Parallel.map_with_index(links, :in_processes => 8) do |object_url, index|
    url = "#{BASEURL}#{object_url}"
    filename = "scrape/html/#{index}.html"
    download_content(url, filename)
  end
end

directory "scrape/html"
